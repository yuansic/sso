define("arale-upload/1.2.0/index",["jquery"],function(t,e,i){function n(t){if(!(this instanceof n))return new n(t);r(t)&&(t={trigger:t});var e={trigger:null,name:null,action:null,data:null,accept:null,change:null,error:null,multiple:!0,success:null};t&&c.extend(e,t);var i=c(e.trigger);e.action=e.action||i.data("action")||"/upload",e.name=e.name||i.attr("name")||i.data("name")||"file",e.data=e.data||o(i.data("data")),e.accept=e.accept||i.data("accept"),e.success=e.success||i.data("success"),this.settings=e,this.setup(),this.bind()}function r(t){return"[object String]"===Object.prototype.toString.call(t)}function s(t){if(!t)return[];var e,i=[];for(var n in t)e=document.createElement("input"),e.type="hidden",e.name=n,e.value=t[n],i.push(e);return i}function o(t){if(!t)return{};for(var e={},i=t.split("&"),n=function(t){return decodeURIComponent(t.replace(/\+/g," "))},r=0;r<i.length;r++){var s=i[r].split("="),o=n(s[0]),a=n(s[1]);e[o]=a}return e}function a(t){for(var e=t.parentsUntil("body"),i=0,n=0;n<e.length;n++){var r=e.eq(n);"static"!==r.css("position")&&(i=parseInt(r.css("zIndex"),10)||i)}return i}function u(){var t="iframe-uploader-"+h,e=c('<iframe name="'+t+'" />').hide();return h+=1,e}function p(t){if(!(this instanceof p))return new p(t);r(t)&&(t={trigger:t});var e=c(t.trigger),i=[];e.each(function(e,r){t.trigger=r,i.push(new n(t))}),this._uploaders=i}var c=t("jquery"),h=0;n.prototype.setup=function(){this.form=c('<form method="post" enctype="multipart/form-data"target="" action="'+this.settings.action+'" />'),this.iframe=u(),this.form.attr("target",this.iframe.attr("name"));var t=this.settings.data;this.form.append(s(t)),this.form.append(window.FormData?s({_uploader_:"formdata"}):s({_uploader_:"iframe"}));var e=document.createElement("input");e.type="file",e.name=this.settings.name,this.settings.accept&&(e.accept=this.settings.accept),this.settings.multiple&&(e.multiple=!0,e.setAttribute("multiple","multiple")),this.input=c(e);var i=c(this.settings.trigger);return this.input.attr("hidefocus",!0).css({position:"absolute",top:0,right:0,opacity:0,outline:0,cursor:"pointer",height:i.outerHeight(),fontSize:Math.max(64,5*i.outerHeight())}),this.form.append(this.input),this.form.css({position:"absolute",top:i.offset().top,left:i.offset().left,overflow:"hidden",width:i.outerWidth(),height:i.outerHeight(),zIndex:a(i)+10}).appendTo("body"),this},n.prototype.bind=function(){var t=this,e=c(t.settings.trigger);e.mouseenter(function(){t.form.css({top:e.offset().top,left:e.offset().left,width:e.outerWidth(),height:e.outerHeight()})}),t.bindInput()},n.prototype.bindInput=function(){var t=this;t.input.change(function(e){t._files=this.files||[{name:e.target.value}];var i=t.input.val();if(t.settings.change)t.settings.change.call(t,t._files);else if(i)return t.submit()})},n.prototype.submit=function(){var t=this;if(window.FormData&&t._files){var e=new FormData(t.form.get(0));e.append(t.settings.name,t._files);var i;if(t.settings.progress){var n=t._files;i=function(){var e=c.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){var i=0,r=e.loaded||e.position,s=e.total;e.lengthComputable&&(i=Math.ceil(r/s*100)),t.settings.progress(e,r,s,i,n)},!1),e}}return c.ajax({url:t.settings.action,type:"post",processData:!1,contentType:!1,data:e,xhr:i,context:this,success:t.settings.success,error:t.settings.error}),this}return t.iframe=u(),t.form.attr("target",t.iframe.attr("name")),c("body").append(t.iframe),t.iframe.one("load",function(){c('<iframe src="javascript:false;"></iframe>').appendTo(t.form).remove();var e;try{e=c(this).contents().find("body").html()}catch(i){e="cross-domain"}c(this).remove(),e?t.settings.success&&t.settings.success(e):t.settings.error&&t.settings.error(t.input.val())}),t.form.submit(),this},n.prototype.refreshInput=function(){var t=this.input.clone();this.input.before(t),this.input.off("change"),this.input.remove(),this.input=t,this.bindInput()},n.prototype.change=function(t){return t?(this.settings.change=t,this):this},n.prototype.success=function(t){var e=this;return this.settings.success=function(i){e.refreshInput(),t&&t(i)},this},n.prototype.error=function(t){var e=this;return this.settings.error=function(i){t&&(e.refreshInput(),t(i))},this},n.prototype.enable=function(){this.input.prop("disabled",!1),this.input.css("cursor","pointer")},n.prototype.disable=function(){this.input.prop("disabled",!0),this.input.css("cursor","not-allowed")},p.prototype.submit=function(){return c.each(this._uploaders,function(t,e){e.submit()}),this},p.prototype.change=function(t){return c.each(this._uploaders,function(e,i){i.change(t)}),this},p.prototype.success=function(t){return c.each(this._uploaders,function(e,i){i.success(t)}),this},p.prototype.error=function(t){return c.each(this._uploaders,function(e,i){i.error(t)}),this},p.prototype.enable=function(){return c.each(this._uploaders,function(t,e){e.enable()}),this},p.prototype.disable=function(){return c.each(this._uploaders,function(t,e){e.disable()}),this},p.Uploader=n,i.exports=p});